<?xml version='1.0' encoding="UTF-8"?>
<chapter id="schema">
	<title>Database schema</title>

	<para>
		If following entities are audited,
	</para>

	<programlisting><![CDATA[public class Address
{
	public virtual int Id {get;set;}
	public virtual int FlatNumber {get;set;}
	public virtual int HouseNumber {get;set;}
	public virtual string StreetName {get;set;}
}
	
public class Person
{
	public virtual int Id {get;set;}
	public virtual string Name {get;set;}
	public virtual string Surname {get;set;}
	public virtual Address Address {get;set;}
}]]></programlisting>
	<para>
		we will need the following schema:
	</para>

	<programlisting><![CDATA[create table Address (
	id integer generated by default as identity (start with 1),
	flatNumber integer,
	houseNumber integer,
	streetName varchar(255),
	primary key (id)
);

create table Address_AUD (
	id integer not null,
	REV integer not null,
	flatNumber integer,
	houseNumber integer,
	streetName varchar(255),
	REVTYPE tinyint not null,
	primary key (id, REV)
);

create table Person (
	id integer generated by default as identity (start with 1),
	name varchar(255),
	surname varchar(255),
	address_id integer,
	primary key (id)
);

create table Person_AUD (
	id integer not null,
	REV integer not null,
	name varchar(255),
	surname varchar(255),
	REVTYPE tinyint not null,
	address_id integer,
	primary key (id, REV)
);

create table REVINFO (
	REV integer generated by default as identity (start with 1),
	REVTSTMP bigint,
	primary key (REV)
);

alter table Person
	add constraint FK8E488775E4C3EA63
	foreign key (address_id)
	references Address;]]></programlisting>
</chapter>